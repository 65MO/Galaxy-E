<tool id="extract_nc_infogcc" name="Netcdf Info gcc" version="0.1.0">
    <requirements>
        <requirement type="package" version="1.1.6">netcdf-metadata-info</requirement> 
    </requirements>
    <command detect_errors="exit_code"><![CDATA[
        netcdf-metadata-info '$input'
        &&
        while read -r l;do
            a=\$(echo \$l | cut -d' ' -f1);echo \$l>dimensions_\$a
        ;done <variables.tabular
        &&
        rm dimensions_VariableName 
        &&
        for f in dimensions_*; do cat \$f | sed 's/ /\t\n/g' | sed '\$s/$/ /' >\$f.tabular ; done
        &&
        for f in dimensions_*.tabular;do
            awk 'NR % 2 != 0' \$f > \$f.2
            &&
            sed 1d \$f.2 > \$f 
            &&
            rm \$f.2
        ;done
        &&
        ncdump -h '$input' > '$info'
    ]]></command>
    <inputs>
        <param type="data" name="input" label="Netcdf file" format="netcdf" help="Netcdf file you need information about."/>
    </inputs>
    <outputs>
        <data name="var_tabs" format="tabular">
            <discover_datasets pattern="__designation_and_ext__" visible="true"/>
            <discover_datasets pattern="conda_activate.log" visible="false"/>
        </data>
        <data name="info" label="info file" format="txt"/>
    </outputs>

    <help><![CDATA[
The Netcdf Info tool use the netcdf functions : https://www.unidata.ucar.edu/software/netcdf/docs/index.html

First the tool will give general information about the input file in the stdout. (command $ncdump -h inputfile)

A general tabular 'variables' summarize dimensions details inside each available variable.

A tabular file is created for every variable, it details dimensions inside it. (dimensions_varX.tabular).

Run this tool before considering using Netcdf Read.
    ]]></help>

</tool>
