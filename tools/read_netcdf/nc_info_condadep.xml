<tool id="extract_nc_infogcc" name="Netcdf Info gcc" version="0.1.0">
    <requirements>
<!--        <requirement type="package" version="4.5.0">libnetcdf</requirement>
        <requirement type="package" version="0.0.1">netcdf_info</requirement> -->
    </requirements>
    <command detect_errors="exit_code"><![CDATA[
        echo \$(ncdump -h '$input') > '$info' && 
##        gcc '$__tool_directory__/NC_info.c' -lnetcdf -o myexe ##&&
        nc_info '$input'
        &&
        while read -r l;do
            a=\$(echo \$l | cut -d' ' -f1);echo \$l>dimensions_\$a
        ;done <variables.tabular 
        &&
        for f in dimensions_*; do cat \$f | sed 's/ /\t\n/g' | sed '\$s/$/ /' >\$f.tabular ; done
        &&
        for f in dimensions_*.tabular;do
            cat \$f | awk 'NR % 2 != 0' \$f > \$f.2
            &&
            sed 1d \$f.2 > \$f 
            &&
            rm \$f.2
        ;done
    ]]></command>
    <inputs>
        <param type="data" name="input" label="Netcdf file" format="netcdf" help="Netcdf file you need information about."/>
    </inputs>
    <outputs>
        <data name="var_tabs">
            <discover_datasets pattern="__designation_and_ext__" visible="true"/>
        </data>
        <data name="info" label="info file" format="txt"/>
    </outputs>

    <help><![CDATA[
The Netcdf Info tool use the netcdf functions : https://www.unidata.ucar.edu/software/netcdf/docs/index.html

First the tool will give general information about the input file in the stdout. (command $ncdump -h inputfile)

A general tabular 'variables' summarize dimensions details inside each available variable.

A tabular file is created for every variable, it details dimensions inside it. (dimensions_varX.tabular).

Run this tool before considering using Netcdf Read.
    ]]></help>

</tool>
