<tool id="gdal_translate" name="GDAL Translate" version="0.1.0">
    <requirements>
        <requirement type="package" version="2.1.0">gdal</requirement>
    </requirements>
    <command detect_errors="exit_code"><![CDATA[
		gdal_translate "$input1" "$output"
			#if $settings.advanced=="advanced"
			
				$settings.strict
				
				#unless $settings.b=="ex : -b 1 -b 2 -b 3"
					$settings.b
				#end unless
				
				#unless $settings.mask=="ex : -mask 1"
					$settings.mask
				#end unless
				
				-r $settings.r
				
				#unless $settings.outsize_x=="ex : 75"				
					-outsize xsize $settings.outsize_x
				#end unless

				#unless $settings.outsize_y=="ex : 75"				
					-outsize ysize $settings.outsize_y
				#end unless
				
				#if $settings.condi_expand.expand=="expand"
					-expand $settings.condi_expand.expand_value
				#end if
				
				#if $settings.condi_scale.scale=="scale"
					-scale $settings.condi_scale.src_min $settings.condi_scale.src_max $settings.condi_scale.dst_min $settings.condi_scale.dst_max
				#end if
					
				#if $settings.condi_srcwin.srcwin=="srcwin"
					-srcwin $settings.condi_srcwin.xoff $settings.condi_srcwin.yoff $settings.condi_srcwin.xsize $settings.condi_srcwin.ysize
				#end if	
				
				$settings.epoeco
				$settings.q
				## $settings.sds
				$settings.stats
				$settings.norat
											
			#end if 
			-of $of
		
    ]]></command>
	<inputs>
		<param type="data" name="input1" format="data" label="Gdal supported input file" help="http://www.gdal.org/formats_list.html"/>    
		<param name="of" type="text" label="Output format" value="gtiff" help="Select the output format. The default is GeoTIFF (GTiff). Use the short format name. http://www.gdal.org/formats_list.html"/>
		<conditional name="settings">
			<param name="advanced" type="select" label="Specify advanced parameters">
				<option value="simple" selected="true">No, use program defaults.</option>
				<option value="advanced">Yes, see full parameter list.</option>
			</param>        
            <when value="simple">
            </when>
            <when value="advanced">
            	<param name="strict" type="boolean" truevalue="-strict" falsevalue="" checked="false" label="-strict" help="Don't be forgiving of mismatches and lost data when translating to the output format."/>
				<param name="b" type="text" label="-b band" help="Select an input band band for output. Bands are numbered from 1. Multiple -b switches may be used to select a set of input bands to write to the output file, or to reorder bands." value="ex : -b 1 -b 2 -b 3"/>
				<param name="mask" type="text" label="-mask band" help="Select an input band band to create output dataset mask band. Bands are numbered from 1. band can be set to 'none' to avoid copying the global mask of the input dataset if it exists. Otherwise it is copied by default ('auto'), unless the mask is an alpha channel, or if it is explicitly used to be a regular band of the output dataset ('-b mask'). band can also be set to 'mask,1' (or just 'mask') to mean the mask band of the 1st band of the input dataset." value="ex : -mask 1"/>
				<param name="r" type="select" label="-r" help="Select a resampling algorithm.">
					<option value="nearest" selected="true"/>
					<option value="bilinear"/>
					<option value="cubic"/>
					<option value="cubicspline"/>
					<option value="lanczos"/>
					<option value="average"/>
					<option value="mode"/>
				</param>	
				<param name="outsize_x" type="text" label="-outsize xsize" value="ex : 75"/>
				<param name="outsize_y" type="text" label="-outsize ysize" value="ex : 75"/>
				
				<conditional name="condi_expand">
					<param name="expand" type="select" label="Expand gray|rgb|rgba" help="To expose a dataset with 1 band with a color table as a dataset with 3 (RGB) or 4 (RGBA) bands. Useful for output drivers such as JPEG, JPEG2000, MrSID, ECW that don't support color indexed datasets. The 'gray' value (from GDAL 1.7.0) enables to expand a dataset with a color table that only contains gray levels to a gray indexed dataset.">
						<option value="no_expand" selected="true">Don't use the -expand option</option>
						<option value="expand">Use the -expand option</option>
					</param>
					<when value="no_expand">
					</when>
					<when value="expand">
						<param name="expand_value" type="select" label="Color table" display="radio" multiple="False">
							<option value="gray" selected="true">GRAY</option>
							<option value="rgb">RGB</option>
							<option value="rgba">RGBA</option>							
						</param>
					</when>
				</conditional>
				
				<conditional name="condi_scale">
					<param name="scale" type="select" label="Rescale the input pixels values" help="Rescale the input pixels values from the range src_min to src_max to the range dst_min to dst_max. If omitted the output range is 0 to 255. If omitted the input range is automatically computed from the source data. Before GDAL 1.11, it can be specified only once, and in that case, it applies to all bands of the output dataset. Starting with GDAL 1.11, -scale can be repeated several times (if specified only once, it also applies to all bands of the output dataset), so as to specify per band parameters. It is also possible to use the '-scale_bn' syntax where bn is a band number (e.g. '-scale_2' for the 2nd band of the output dataset) to specify the parameters of one or several specific bands.">
						<option value="no_scale" selected="true">Don't use the -scale option</option>
						<option value="scale">Use the -scale option</option>
					</param>
					<when value="no_scale">
					</when>
					<when value="scale">
						<param name="src_min" type="text" label="src_min" value="0"/>
						<param name="src_max" type="text" label="src_max" value="0"/>
						<param name="dst_min" type="text" label="dst_min" value="0"/>
						<param name="dst_max" type="text" label="dst_max" value="0"/>
					</when>
				</conditional>
				
				<conditional name="condi_srcwin">
					<param name="srcwin" type="select" label="Selects a subwindow from the source image" help="Selects a subwindow from the source image for copying based on pixel/line location.">
						<option value="no_srcwin" selected="true">Don't use the -srcwin option</option>
						<option value="srcwin">Use the -srcwin option</option>
					</param>
					<when value="no_srcwin">
					</when>
					<when value="srcwin">
						<param name="xoff" type="text" label="xoff" value="0"/>
						<param name="yoff" type="text" label="yoff" value="0"/>
						<param name="xsize" type="text" label="xsize" value="0"/>
						<param name="ysize" type="text" label="ysize" value="0"/>
					</when>
				</conditional>				
				
				<param name="epoeco" type="select" label="Display error when outside the source raster" display="radio" multiple="False">
					<option value="" selected="true">Default, no error</option>
					<option value="-epo">-epo : Error when partially outside</option>
					<option value="-eco">-eco : Error when completely outside</option>				
				</param>
				<param name="q" type="boolean" truevalue="-q" falsevalue="" checked="false" label="-q" help="Suppress progress monitor and other non-error output."/>
				<!--
				<param name="sds" type="boolean" truevalue="-sds" falsevalue="" checked="false" label="-sds" help="Copy all subdatasets of this file to individual output files. Use with formats like HDF or OGDI that have subdatasets. The output file naming scheme has changed in GDAL 1.11 (e.g. ofile_1.tif, ofile_2.tif)."/>
				Ici il y a surement une gestion de fichiers de sorties multiple Ã  faire
				-->
				<param name="stats" type="boolean" truevalue="-stats" falsevalue="" checked="false" label="-stats" help="Force (re)computation of statistics."/>
				<param name="norat" type="boolean" truevalue="-norat" falsevalue="" checked="false" label="-norat" help="Do not copy source RAT into destination dataset."/>
			</when>
		</conditional>
	</inputs>
	<outputs>
		<data name="output" auto_format="true" label="${input1.name}.${of}"/>
	</outputs>
	<tests>
		<test>
			<param name="input1" value="dataset/stere.tif"/>
			<output name="output" file="dataset/stere.JPEG"/>
		</test>
	</tests>
	<help><![CDATA[
        
The gdal_translate utility can be used to convert raster data between different formats, potentially performing some operations like subsettings, resampling, and rescaling pixels in the process. 

http://www.gdal.org

http://www.gdal.org/gdal_translate.html

	]]></help>
</tool>
