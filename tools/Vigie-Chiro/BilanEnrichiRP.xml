<tool id="BilanEnrichiRP" name="BilanEnrichiRP.R" version="0.1">
    <requirements>
        <requirement type="package" version="7.0">readline</requirement> 
        <requirement type="package" version="1.4.3">r-reshape2</requirement> 
        <requirement type="package" version="1.10.4">r-data.table</requirement>
        <requirement type="package" version="0.2">r-dt</requirement>
        <requirement type="package" version="0.9">r-htmlwidgets</requirement>
        <requirement type="package" version="2.1.1">pandoc</requirement>
        <requirement type="package" version="54">icu</requirement>  
    </requirements>
    <command detect_errors="exit_code"><![CDATA[
        Rscript 
            '$__tool_directory__/BilanEnrichiRP.R' '$IdC2' '$__tool_directory__/refRPSeuil50.csv' '$__tool_directory__/SpeciesList.csv' 
 
            ## List of outputs :
            ##'$output_summary_tabular' '$output_summary_html' 
            ##'$output_detail_tabular' '$output_detail_html' 
            ##'$barplot'
        ;
        tail -n +2 output-summaryRP.html > tmp && mv tmp output-summaryRP.html;
        tail -n +2 output-detailRP.html > tmp && mv tmp output-detailRP.html;
]]>
    </command>
    <inputs>
        <param name="IdC2" type="data" format="tabular" label="IdValid output"/>
    </inputs>
    <outputs>
        <data name="output_summary_tabular" format="tabular" from_work_dir="output-summaryRP.tabular" label="${tool.name} on ${on_string} Summary"/>
        <data name="output_summary_html" format="html" from_work_dir="output-summaryRP.html" label="${tool.name} on ${on_string} Summary"/>

        <data name="output_detail_tabular" format="tabular" from_work_dir="output-detailRP.tabular" label="${tool.name} on ${on_string} Detail"/>
        <data name="output_detail_html" format="html" from_work_dir="output-detailRP.html" label="${tool.name} on ${on_string} Detail"/>

       <!-- TODO see if usefull to implement
       <data name="barplot" format="png" from_work_dir="Rplots.png" label="${tool.name} on ${on_string}"/>
       -->
    </outputs>

    <tests>
        <test>
            <param name="IdC2" value="BilanEnrichiPF_Test1.tabular"/>
            <output name="output_tab" file="BilanEnrichiPF_Test1_out_tab.tabular" ftype="tabular"/>
            <!--
            <output name="output_html" file="BilanEnrichiPF_Test1_out_html.html" ftype="html"/>
            -->
        </test>
    </tests>

    <help><![CDATA[
**What it does**

The tool analyses the observations made with the "Routier" or "Pedestre" protocols.

**Arguments**

- Input is an observation/participation file corrected by the tools IdCorrect_2ndLayer and IdValid.
- Outputs are Summary and details raw tabulars, and html visualisations.


  ]]></help>
</tool>
